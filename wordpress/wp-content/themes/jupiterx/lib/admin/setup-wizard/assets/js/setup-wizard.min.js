"use strict";!function(p){var l,u,n,i=p(".jupiterx-nav"),s=p(".jupiterx-content"),a=p(window),o={};l=function(t,e){return _.isObject(t)&&(t=(e=_.extend(t,{})).data.action),(e=_.defaults(e||{},{type:"POST",url:_wpUtilSettings.ajax.url})).data=_.extend(e.data||{},{action:"jupiterx_setup_wizard_"+t}),p.ajax(e)},u=function(){l({data:{action:"next_page"},success:function(t){var e=t.data;s.hide().attr("class","jupiterx-content").addClass("jupiterx-"+e.page).html(e.html).fadeIn(500),i.trigger("next.owl.carousel"),a.trigger("content-loaded",e.page)}})},n=function(){s.find(".jupiterx-next").on("click",function(t){t.preventDefault(),p(this).button("loading"),u()})},p.fn.button=function(e,n){this.each(function(){var t=p(this);switch(e){case"loading":t.attr("disabled","disabled"),n||t.append('<i class="fa fa-circle-notch fa-spin"></i>');break;case"default":t.removeAttr("disabled").find(".fa").remove()}})},p.fn.alert=function(i){return this.each(function(){var t=p(this),e=wp.template("jupiterx-alert"),n=p(e(i));t.find(".alert").remove(),t.prepend(n),a.scrollTop(n.position().top-30)}),this},p.fn.blockUi=function(){return this.each(function(){p(this).addClass("jupiterx-block-ui")}),this},p.fn.unblockUi=function(){return this.each(function(){p(this).removeClass("jupiterx-block-ui")}),this},p.fn.overlaySpinner=function(){return this.each(function(){p(this).addClass("jupiterx-overlay-spinner").append(wp.template("jupiterx-spinner")())}),this},p.fn.removeOverlaySpinner=function(){return this.each(function(){p(this).removeClass("jupiterx-overlay-spinner").find(".jupiterx-spinner-container").remove()}),this},o["api-activation"]={init:function(){var n=s.find(".jupiterx-form"),i=n.find("button.jupiterx-activate"),e=n.find("input[type=text]");i.on("click",function(t){t.preventDefault(),l({data:{action:"activate_api",api_key:e.val()},beforeSend:function(){i.button("loading")}}).success(function(t){var e=t.data;e.status?u():(i.button("default"),n.alert({message:e.message,type:"danger"}))})})}},o.plugins={init:function(){var i=s.find(".jupiterx-form"),a=i.find(".jupiterx-plugins-list"),o=i.find("button.btn");o.on("click",function(t){t.preventDefault();var e=i.find("input[type=checkbox]:checked"),n=[];e.each(function(){n.push(p(this).val())}),l({data:{action:"install_plugins",plugins:n},beforeSend:function(){o.button("loading"),a.blockUi()}}).success(function(t){t.hasOwnProperty("install")?p.ajax({type:"POST",url:t.url,data:t.install,success:function(t){l({data:{action:"activate_plugins",plugins:n}}).success(function(t){t.hasOwnProperty("activate")&&p.ajax({type:"POST",url:t.url,data:t.activate,success:function(t){u()}})})}}):l({data:{action:"activate_plugins",plugins:n}}).success(function(t){t.hasOwnProperty("activate")&&p.ajax({type:"POST",url:t.url,data:t.activate,success:function(t){u()}})})})})}},o.templates={elements:{},pageStart:0,postsPerPage:9,filterName:null,category:null,loadComplete:!1,isLoading:!1,isInstalling:!1,init:function(){var t=this,e=t.elements;e.$form=s.find(".jupiterx-form"),e.$filter=s.find(".jupiterx-templates-filter"),e.$templates=s.find(".jupiterx-templates-body"),t.filterEvents(),t.loadTemplates(function(){a.scroll(_.throttle(t.infiniteLoad.bind(t),250))})},filterEvents:function(){var e,n=this,t=n.elements,i=t.$filter,a=t.$templates,o=i.find(".jupiterx-templates-filter-name"),s=i.find(".jupiterx-templates-filter-category"),r=i.find(".jupiterx-submit"),l=i.find(".dropdown-toggle"),u=i.find(".dropdown-menu");e=function(){n.pageStart=0,n.loadComplete=!1,n.filterName=o.val(),n.category=s.val(),a.empty()},r.on("click",function(){n.isLoading||n.isInstalling||(event.preventDefault(),r.button("loading",!0),e(),n.loadTemplates(function(){r.button("default")}))}),u.on("click",".dropdown-item",function(){if(!n.isLoading&&!n.isInstalling){var t=p(this);l.text(t.text()),s.val(t.data("value")),e(),n.loadTemplates()}})},loadTemplates:function(t){var n=this,e=n.elements,i=n.pageStart,a=n.postsPerPage,o=e.$templates,s=void 0;n.isLoading||(n.loadComplete?t&&t():(o.find(".jupiterx-spinner-container").length||n.addSpinner(),(s=l({data:{action:"get_templates",pagination_start:n.pageStart,pagination_count:n.postsPerPage,template_name:n.filterName,template_category:n.category},beforeSend:function(){n.isLoading=!0}})).success(function(t){if(t.data.status){var e=t.data.templates||[];_.each(e,n.templateBox.bind(n))}}),s.success(function(t){var e=t.data.templates||[];n.pageStart=i+a,e.length<a&&(n.removeSpinner(),n.loadComplete=!0)}),s.done(function(){n.isLoading=!1}),t&&s.done(t)))},templateBox:function(s){var r,l=this,t=wp.template("jupiterx-template"),e=l.elements.$templates.children(".jupiterx-spinner-container"),u=void 0;r=_.extend(s,{nameClean:s.name.replace(" Jupiterx",""),slugClean:s.slug.replace("-jupiterx","")}),(u=p(t(r)).insertBefore(e).imagesLoaded().always(function(){u.find("figure").addClass("jupiterx-images-loaded")})).on("click",".jupiterx-template-import",function(t){if(t.preventDefault(),!l.isInstalling){var e,n,i,a=p(this),o=u.find("figure");e=function(){l.isInstalling=!1},n=function(){l.isInstalling=!1,o.removeOverlaySpinner(),a.button("default")},i=function(t){l.isInstalling=!0,o.overlaySpinner(),a.button("loading",!0),l.importTemplate(s,t,e,n)},jupiterx_modal({type:"warning",title:jupiterxWizardSettings.i18n.installTemplateTitle,text:jupiterxWizardSettings.i18n.installTemplate.replace("{template}",r.nameClean),confirmButtonText:jupiterxWizardSettings.i18n.confirm,cancelButtonText:jupiterxWizardSettings.i18n.cancel,showCancelButton:!0,showConfirmButton:!0,onConfirm:function(){jupiterx_modal({type:"warning",title:jupiterxWizardSettings.i18n.importMediaTitle,text:jupiterxWizardSettings.i18n.importMedia,confirmButtonText:jupiterxWizardSettings.i18n.mediaConfirm,cancelButtonText:jupiterxWizardSettings.i18n.mediaCancel,showCancelButton:!0,showConfirmButton:!0,onConfirm:function(){i(!1)},onCancel:function(){i(!0)}})}})}}).on("click",".jupiterx-template-psd-link",function(){var t=p(this);t.button("loading",!0),l.templatePsd(s,function(){t.button("default")})})},importTemplate:function(t,e,n,i){var a=this.elements,o=0,s=["preparation","backup_db","backup_media_records","reset_db","upload","unzip","validate","install_plugins","activate_plugins","theme_content","setup_pages","plugins_content","settings","menu_locations","theme_widget","restore_media_records","finalize"],r=void 0;(r=function(){l({data:{action:"import_template",type:s[o],import_media:e,template_id:t.id,template_name:t.name}}).success(function(t){if("string"==typeof t&&(t=JSON.parse(t)),"install_plugins"===s[o])t.hasOwnProperty("install")?p.ajax({type:"POST",url:t.url,data:t.install,success:function(){o++,r()}}):(o++,r());else if("activate_plugins"===s[o])t.hasOwnProperty("activate")?p.ajax({type:"POST",url:t.url,data:t.activate,success:function(){o++,r()}}):(o++,r());else{if(!t.status)return i&&i(),void a.$form.alert({message:t.message||t.data.message,type:"danger"});++o<s.length?(r(),console.log(t.message)):(n&&n(),u())}})})()},templatePsd:function(t,e){var n=l({data:{action:"get_template_psd",template_name:t.slugClean}});n.success(function(t){t.status&&t.data&&t.data.psd_link&&(top.location.href=t.data.psd_link)}),e&&n.done(e)},infiniteLoad:function(){var t=this.elements.$templates;a.scrollTop()>t.offset().top+t.height()-a.height()&&this.loadTemplates()},addSpinner:function(){this.elements.$templates.append(wp.template("jupiterx-spinner")())},removeSpinner:function(){this.elements.$templates.find(".jupiterx-spinner-container").remove()}},i.owlCarousel({center:!0,items:3,loop:!1,dots:!1,nav:!1,mouseDrag:!1,touchDrag:!1,pullDrag:!1,startPosition:jupiterxWizardSettings.currentPageIndex}),a.on("content-loaded",function(t,e){n(),e&&o[e]&&_.isFunction(o[e].init)&&o[e].init()}),a.trigger("content-loaded",jupiterxWizardSettings.currentPage)}(jQuery);